import { Controller, Get } from '@nestjs/common'
import { WebsocketIntentService } from './websocket-intent.service'
import { Network } from 'alchemy-sdk'
import { ValidateIntentService } from './validate-intent.service'
import { SourceIntent } from '../eco-configs/eco-config.types'
import { Logger } from '@nestjs/common'
import { EcoLogMessage } from '../common/logging/eco-log-message'

@Controller('intent')
export class SourceIntentController {
  private logger = new Logger(SourceIntentController.name)
  constructor(
    private readonly wsService: WebsocketIntentService,
    private readonly validateService: ValidateIntentService,
  ) { }

  @Get()
  async fakeIntent() {
    const si: SourceIntent = {
      network: intent.sourceNetwork as Network,
      chainID: intent.sourceChainID,
      sourceAddress: '',
      tokens: [],
    }
    this.logger.debug(
      EcoLogMessage.fromDefault({
        message: `fakeIntent intent`,
        properties: {
          si: si,
        },
      }),
    )

    return await this.wsService.addJob(si)(intentFail)
    // return this.wsService.addJob(Network.OPT_SEPOLIA)(intent)
  }

  @Get('process')
  async fakeProcess() {
    const hash = '0x9e129faa46bf5791a3f84fb6f18a73fe3a8412a358517e5fe98d9c1b1bd7d831'
    return await this.validateService.validateIntent(hash)
    //  await this.intentQueue.add(QUEUES.SOURCE_INTENT.jobs.process_intent, hash, {
    //   jobId: hash,
    // })
  }
}
const intentFail = {
  blockNumber: 19562099,
  blockHash: "0xebb3dcfd3695b4a5891a78b38de32bac2c29d9fb6af4da9c23215eb9929f3b6f",
  transactionIndex: 39,
  removed: false,
  address: "0x26D2C47c5659aC8a1c4A29A052Fa7B2ccD45Ca43",
  data: "0x000000000000000000000000c9ef11eef77b7972ad0014a25b9381dad449959400000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000020002d4731f12590bc3cee7e45917db909f0db339f2790a0149b82893c95caa89cb000000000000000000000000000000000000000000000000000000000000000100000000000000000000000094b008aa00579c1307b0ef2c499ad98a8ce58e58000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000c9ef11eef77b7972ad0014a25b9381dad449959400000000000000000000000000000000000000000000000000000000000fb384000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000d9aaec86b65d86f6a7b5b1b0c42ffa531710b6ca000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000fb384",
  topics: [
    "0x4d57d71884135619aa0097f5e665cc0257fcf37b35433f4b554f57a182e77416",
    "0x0d52f783d79a0cb7087a368760f13b038920ebccfcb8f776d9d37a8471f6f18b",
    "0x000000000000000000000000000000000000000000000000000000000000000a",
    "0x0000000000000000000000000000000000000000000000000000000066f1cec1"
  ],
  transactionHash: "0xf4c341ef2a2dc5ea8681ed588aee03d9da877a377409fee09b17b92035fa814e",
  logIndex: 92,
  sourceNetwork: "base-mainnet" as Network,
  sourceChainID: 8453
}
const intent = {
  blockNumber: 124371627,
  blockHash: '0xa1d2764a1a84a4d80b0eac0957c720d275b4ec5ad45fda9815515e7e582db436',
  transactionIndex: 3,
  removed: false,
  address: '0x532BA2D408e77B773b1d05Dafa5E4A2392e5ED11',
  data: '0x000000000000000000000000448729e46c442b55c43218c6db91c4633d36dfc000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000200914dccb53380563059e9e556af6a690bb3e3d2e8763db4999263479efe191eda0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000c0bc9ba69acd4806c4c48dd6fdfc1677212503e900000000000000000000000000000000000000000000000000000000000003e80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff85000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000003e9',
  topics: [
    '0x4d57d71884135619aa0097f5e665cc0257fcf37b35433f4b554f57a182e77416',
    '0x6b4007c776248e3ab3913b4d9e68a4747998caa8d5cee290c1c960b2be1d23e1',
    '0x0000000000000000000000000000000000000000000000000000000000002105',
    '0x0000000000000000000000000000000000000000000000000000000066c77b2b',
  ],
  transactionHash: '0x9e129faa46bf5791a3f84fb6f18a73fe3a8412a358517e5fe98d9c1b1bd7d831',
  logIndex: 21,
  sourceNetwork: 'opt-mainnet' as Network,
  sourceChainID: 10,
}

const intentCarlos = {
  blockNumber: 124378730,
  blockHash: '0xefe5b2713f1b93508dad148bfd5cb7db8fe2c903951ec79cda6820d25241ef81',
  transactionIndex: 4,
  removed: false,
  address: '0x532BA2D408e77B773b1d05Dafa5E4A2392e5ED11',
  data: '0x000000000000000000000000476ef0cd1bcd3e75ed31bea2a6397a43c8acb9d500000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002006c6d62e8a8b03fc99bb6a42c33f29fbb7bc355fb24b55c501263cba498f989820000000000000000000000000000000000000000000000000000000000000001000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000476ef0cd1bcd3e75ed31bea2a6397a43c8acb9d500000000000000000000000000000000000000000000000000000000000f90600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff85000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f9448',
  topics: [
    '0x4d57d71884135619aa0097f5e665cc0257fcf37b35433f4b554f57a182e77416',
    '0xe664ead4b947594b8a7078bd1b53b60939194e237b609151eb15f0c0d83e99d0',
    '0x0000000000000000000000000000000000000000000000000000000000002105',
    '0x0000000000000000000000000000000000000000000000000000000066c7a493',
  ],
  transactionHash: '0xe4b05fa45c2fb6e6602b93dab589a6345d82de759a35403e515da3633f44a2e9',
  logIndex: 9,
  sourceNetwork: 'opt-mainnet' as Network,
  sourceChainID: 10,
}

const intentV1 = {
  blockNumber: 124596241,
  blockHash: '0xdecfdc5190e1fa1e9cc7f7d55b6bddc450bb700baefcdf62f1016315c17aaf71',
  transactionIndex: 8,
  removed: false,
  address: '0x532BA2D408e77B773b1d05Dafa5E4A2392e5ED11',
  data: '0x000000000000000000000000476ef0cd1bcd3e75ed31bea2a6397a43c8acb9d500000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000002000b08f08bef37a4a22e8f6284561101ae9e8aa26b526bb938f6da1d1967f3a7f80000000000000000000000000000000000000000000000000000000000000001000000000000000000000000833589fcd6edb6e08f4c7c32d4f71b54bda02913000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000476ef0cd1bcd3e75ed31bea2a6397a43c8acb9d500000000000000000000000000000000000000000000000000000000000f90600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000b2c639c533813f4aa9d7837caf62653d097ff85000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f9448',
  topics: [
    '0x4d57d71884135619aa0097f5e665cc0257fcf37b35433f4b554f57a182e77416',
    '0x6d8654917d43df4c605661e0ff23e7aa33f972066761eb872a1e64243cadf0ac',
    '0x0000000000000000000000000000000000000000000000000000000000002105',
    '0x0000000000000000000000000000000000000000000000000000000066ce47e3',
  ],
  transactionHash: '0xb44ef3fd0782f861cc5330b87a44db78baebee9674c4da3e730bf8393a6e528a',
  logIndex: 49,
  sourceNetwork: 'opt-mainnet' as Network,
  sourceChainID: 10,
}