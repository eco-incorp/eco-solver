import { Controller, Get } from '@nestjs/common'
import { WebsocketIntentService } from './websocket-intent.service'
import { Network } from 'alchemy-sdk'
import { ValidateIntentService } from './validate-intent.service'
import { SourceIntent } from '../eco-configs/eco-config.types'
import { Logger } from '@nestjs/common'
import { EcoLogMessage } from '../common/logging/eco-log-message'
import { ViemEventLog } from '../common/events/websocket'

@Controller('intent')
export class SourceIntentController {
  private logger = new Logger(SourceIntentController.name)
  constructor(
    private readonly wsService: WebsocketIntentService,
    private readonly validateService: ValidateIntentService,
  ) {}

  @Get()
  async fakeIntent() {
    const si: SourceIntent = {
      network: (intent[0] as ViemEventLog).sourceNetwork as Network,
      chainID: (intent[0] as ViemEventLog).sourceChainID,
      sourceAddress: '0x',
      tokens: [],
      provers: [],
    }
    this.logger.debug(
      EcoLogMessage.fromDefault({
        message: `fakeIntent intent`,
        properties: {
          si: si,
        },
      }),
    )

    return await this.wsService.addJob(si)(intent)
    // return this.wsService.addJob(Network.OPT_SEPOLIA)(intent)
  }

  @Get('process')
  async fakeProcess() {
    const hash = '0xe42305a292d4df6805f686b2d575b01bfcef35f22675a82aacffacb2122b890f'
    return await this.validateService.validateIntent(hash)
    //  await this.intentQueue.add(QUEUES.SOURCE_INTENT.jobs.process_intent, hash, {
    //   jobId: hash,
    // })
  }
}
const intent = [
  {

    blockNumber: 17727653,
    blockHash: "0x0e3ef1f419e94a2aaf1af489fb74e78c3259f2822b4bf36333f7d91cb5265864",
    transactionIndex: 6,
    removed: false,
    address: "0xc135737f2a05b0f65c33dab7c60e63e3e2008c6c",
    data: "0x00000000000000000000000054bc21ea3b711333755b25d2dc63c726163d2db300000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002208bdcd799936fcae0938498fe831af7963789bb046d6caf8db66b40fe9b198cc50000000000000000000000007c6a40f388dfd4cf1a8456978c55227f3e968ab70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000ab1d243b07e99c91de9e4b80dfc2b07a8332a2f7000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000054bc21ea3b711333755b25d2dc63c726163d2db300000000000000000000000000000000000000000000000000000000000f3708000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000d3f4bef596a04e2be4fbeb17dd70f02f717c5a6c000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f3708",
    topics: [
      "0x653c41cbe9402a28b206076ac6e316307a1ef8f76f247c1da9fdc2f50a405819",
      "0x696642676fe79c1c31e824e78b6423700a988f5b2bcf863e3790d5dcfd35f385",
      "0x0000000000000000000000000000000000000000000000000000000000014a34",
      "0x00000000000000000000000000000000000000000000000000000000670651ea"
    ],
    transactionHash: "0xff786902e77d514cf69716ecd598884b07752826b010cd53f0bd525f375ca0a8",
    logIndex: 27,
    sourceNetwork: 'opt-sepolia' as Network,
    sourceChainID: 11155420,
  } as unknown as ViemEventLog,
  {
    blockNumber: 17727653,
    blockHash: "0x0e3ef1f419e94a2aaf1af489fb74e78c3259f2822b4bf36333f7d91cb5265864",
    transactionIndex: 6,
    removed: false,
    address: "0xc135737f2a05b0f65c33dab7c60e63e3e2008c6c",
    data: "0x00000000000000000000000054bc21ea3b711333755b25d2dc63c726163d2db300000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000220446587c28c36795d9b65957c312f30eada29f2124561f9555d1a686b473a7f240000000000000000000000007c6a40f388dfd4cf1a8456978c55227f3e968ab70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000ab1d243b07e99c91de9e4b80dfc2b07a8332a2f7000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000044a9059cbb00000000000000000000000054bc21ea3b711333755b25d2dc63c726163d2db300000000000000000000000000000000000000000000000000000000000f4d7800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000093551e3f61f8e3ee73ddc096bddbc1adc52f5a3a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f4d78",
    topics: [
      "0x653c41cbe9402a28b206076ac6e316307a1ef8f76f247c1da9fdc2f50a405819",
      "0xa26c3a833f5134dfe6831b152a1dd518d933f8e6271fd1e971c4ad0786737ba4",
      "0x0000000000000000000000000000000000000000000000000000000000014a34",
      "0x00000000000000000000000000000000000000000000000000000000670651ea"
    ],
    transactionHash: "0xff786902e77d514cf69716ecd598884b07752826b010cd53f0bd525f375ca0a8",
    logIndex: 23,
    sourceNetwork: 'opt-sepolia' as Network,
    sourceChainID: 11155420,
  } as unknown as ViemEventLog,
]
